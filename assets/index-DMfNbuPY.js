(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function n(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(t){if(t.ep)return;t.ep=!0;const s=n(t);fetch(t.href,s)}})();const A=(()=>{const e="TapTalkDB",n="comm_events";let i=null;function t(){return i?Promise.resolve(i):new Promise((a,r)=>{const o=indexedDB.open(e,1);o.onupgradeneeded=c=>{const m=c.target.result;m.objectStoreNames.contains(n)||m.createObjectStore(n,{keyPath:"id",autoIncrement:!0})},o.onsuccess=c=>{i=c.target.result,a(i)},o.onerror=c=>{console.warn("[TapTalkDB] Open error â€” logging disabled, app continues normally:",c.target.error),r(c.target.error)}})}async function s(a,r){var c;const o={timestamp:new Date().toISOString(),eventType:a,words:Array.isArray(r.words)?r.words:[],view:r.view||"",user:(c=window.PartnerMode)!=null&&c.isActive()?"partner":"student"};try{(await t()).transaction(n,"readwrite").objectStore(n).add(o)}catch(m){console.warn("[TapTalkDB] logEvent failed â€” app continues normally:",m)}}async function u(){const a=await t();return new Promise((r,o)=>{const m=a.transaction(n,"readonly").objectStore(n).getAll();m.onsuccess=()=>r(m.result),m.onerror=()=>o(m.error)})}async function g(){const a=await t();return new Promise((r,o)=>{const m=a.transaction(n,"readwrite").objectStore(n).clear();m.onsuccess=()=>r(),m.onerror=()=>o(m.error)})}return{logEvent:s,getAll:u,clearAll:g}})();window.CommDB=A;window.exportTapTalkData=async function(){const e=await A.getAll(),d=JSON.stringify(e,null,2);return console.log("[TapTalkDB] exportTapTalkData ("+e.length+` records):
`,d),d};async function x(){const e=await CommDB.getAll(),d=e.filter(i=>i.user==="student").length,n=e.filter(i=>i.user==="partner").length;return{source:"TapTalk_AAC",version:"1.0",exportDate:new Date().toISOString(),metrics:{totalEvents:e.length,studentEvents:d,partnerModeEvents:n},logs:e}}window.generateOSPayload=x;function V(){try{const e=localStorage.getItem(f.LS_VOCAB_KEY);if(e)return JSON.parse(e)}catch{}return[]}window.getVocab=V;const f=Object.freeze({DB_NAME:"taptalk-db",DB_VERSION:1,STORE_EVENTS:"events",BANK_ITEMS:["Rocks","Ball","Walk","Coloring","Book","Math","Writing"],CORE_VOCAB:["Yes","No"],TURN_VOCAB:["my-turn","your-turn"],LS_VOCAB_KEY:"activeVocabulary",LS_VOICE_KEY:"selectedVoiceURI"}),I=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`session-${Date.now()}-${Math.random().toString(36).slice(2)}`,O=(()=>{let e=!1;function d(){return e}function n(){const s=document.getElementById("app"),u=document.getElementById("partner-mode-toggle");e?(s.classList.add("partner-mode"),u.textContent="ðŸ”“",u.setAttribute("aria-pressed","true"),u.title="Partner Mode ON â€” tap to disable"):(s.classList.remove("partner-mode"),u.textContent="ðŸ”’",u.setAttribute("aria-pressed","false"),u.title="Enable Partner Mode")}function i(){e=!e,n(),E.log("partner_mode_changed",{active:e})}function t(){document.getElementById("partner-mode-toggle").addEventListener("click",i),n()}return{isActive:d,init:t}})(),E=(()=>{let e=null;function d(){return new Promise((t,s)=>{const u=indexedDB.open(f.DB_NAME,f.DB_VERSION);u.onupgradeneeded=g=>{const a=g.target.result;if(!a.objectStoreNames.contains(f.STORE_EVENTS)){const r=a.createObjectStore(f.STORE_EVENTS,{keyPath:"id",autoIncrement:!0});r.createIndex("timestamp","timestamp",{unique:!1}),r.createIndex("sessionId","sessionId",{unique:!1}),r.createIndex("type","type",{unique:!1})}},u.onsuccess=g=>{e=g.target.result,t(e)},u.onerror=g=>{s(g.target.error)}})}function n(t,s){const u={timestamp:new Date().toISOString(),sessionId:I,type:t,data:s,user:O.isActive()?"partner":"student"};if(!e){v.append({...u,id:"pending"});return}const r=e.transaction(f.STORE_EVENTS,"readwrite").objectStore(f.STORE_EVENTS).add(u);r.onsuccess=o=>{u.id=o.target.result,v.append(u)},r.onerror=()=>{}}function i(){return new Promise((t,s)=>{if(!e)return s(new Error("DB not ready"));const g=e.transaction(f.STORE_EVENTS,"readonly").objectStore(f.STORE_EVENTS).getAll();g.onsuccess=()=>t(g.result),g.onerror=()=>s(g.error)})}return{open:d,log:n,getAll:i}})(),b=(()=>{let e=!1;function d(){if(e||!window.speechSynthesis)return;e=!0;const t=new SpeechSynthesisUtterance("");t.volume=0,window.speechSynthesis.speak(t)}function n(t){if(!window.speechSynthesis)return;window.speechSynthesis.cancel();const s=new SpeechSynthesisUtterance(t);s.rate=.9,s.pitch=1,s.volume=1;try{const u=localStorage.getItem(f.LS_VOICE_KEY);if(u){const g=window.speechSynthesis.getVoices().find(a=>a.voiceURI===u);g&&(s.voice=g)}}catch{}window.speechSynthesis.speak(s)}function i(){window.addEventListener("load",()=>{var t;return(t=window.speechSynthesis)==null?void 0:t.getVoices()}),document.addEventListener("pointerdown",d,{once:!0,capture:!0})}return{speak:n,init:i}})(),L=(()=>{function e(i){return`./aac-images/${i.toLowerCase()}.png`}function d(i,t){i.src=e(t),i.onerror=()=>{i.onerror=null,L._fallbackTile(i,t)}}function n(i){return e(i)}return{load:d,getCachedUrl:n}})(),v=(()=>{const e=()=>document.getElementById("dev-preview-entries"),d=()=>document.getElementById("dev-preview-count");let n=0;function i(){var o;document.getElementById("dev-status-session").textContent=I.slice(0,13)+"â€¦",document.getElementById("dev-status-version").textContent=((o=window.TapTalk)==null?void 0:o.version)??"1.0.0",document.getElementById("dev-preview-clear").addEventListener("click",()=>{e().innerHTML="",n=0,t()}),document.getElementById("dev-preview-refresh").addEventListener("click",g),document.getElementById("dev-preview-export").addEventListener("click",async()=>{var c;try{const m=await((c=window.exportTapTalkData)==null?void 0:c.call(window));if(!m)return;const l=new Blob([m],{type:"application/json"}),p=URL.createObjectURL(l),w=document.createElement("a");w.href=p,w.download=`taptalk-export-${Date.now()}.json`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(p)}catch{}})}function t(){d().textContent=`${n} event${n!==1?"s":""} logged`}function s(o){const c=document.createElement("div");c.className="dev-log-entry";const m=new Date(o.timestamp).toLocaleTimeString(),l=o.id!=null?`[${o.id}] `:"";return c.innerHTML=`<span class="log-time">${m}</span><span class="log-type">${l}${o.type}</span>${JSON.stringify(o.data)}`,c}function u(o){n++,t(),e().prepend(s(o))}async function g(){try{const o=await E.getAll();e().innerHTML="",n=o.length,t(),[...o].reverse().forEach(c=>e().appendChild(s(c)))}catch{}}function a(o){const c=document.getElementById("dev-status-db");c.textContent=o?"open âœ“":"error âœ—",c.className="dev-status-value "+(o?"dev-status-ok":"dev-status-err")}function r(o,c){const m=document.getElementById("dev-status-sw");m.textContent=o,m.className="dev-status-value "+(c?"dev-status-ok":"dev-status-err")}return{init:i,append:u,setDbStatus:a,setSwStatus:r}})(),$=(()=>{function e(n){document.querySelectorAll(".view").forEach(i=>i.classList.remove("active")),document.querySelectorAll(".nav-btn").forEach(i=>i.classList.remove("active")),document.getElementById(`view-${n}`).classList.add("active"),document.querySelector(`.nav-btn[data-view="${n}"]`).classList.add("active"),E.log("view_changed",{view:n})}function d(){document.querySelectorAll(".nav-btn").forEach(n=>{n.addEventListener("click",()=>e(n.dataset.view))})}return{init:d,switchTo:e}})(),R=(()=>{function e(){["yes","no"].forEach(n=>{const i=document.getElementById(`btn-${n}`),t=document.getElementById(`img-${n}`);L.load(t,n),i.addEventListener("click",()=>{var s;b.speak(n),E.log("vocabulary_use",{word:n,category:"core_vocab"}),(s=window.CommDB)==null||s.logEvent("single_word",{words:[n],view:"core-vocab"})})})}return{init:e}})(),D=(()=>{const e=[null,null];function d(a,r){const o=document.getElementById(`slot-${a+1}`);o.classList.remove("empty"),o.innerHTML="";const c=document.createElement("img");c.alt=r,o.appendChild(c),L.load(c,r.toLowerCase());const m=document.createElement("span");m.className="slot-label",m.textContent=r,o.appendChild(m)}function n(a){const r=document.getElementById(`slot-${a+1}`);r.classList.add("empty"),r.innerHTML='<span class="slot-placeholder">?</span>'}function i(a){var r,o;if(e[0]===null)e[0]=a,d(0,a),E.log("choice_slot_filled",{slot:1,word:a});else if(e[1]===null){e[1]=a,d(1,a);const c=`${e[0]} or ${e[1]}`;b.speak(c),E.log("choice_made",{choice1:e[0],choice2:e[1],phrase:c}),(r=window.CommDB)==null||r.logEvent("sentence_formed",{words:[e[0],e[1]],view:"choice-board"})}else b.speak(`${e[0]} or ${e[1]}`),(o=window.CommDB)==null||o.logEvent("sentence_formed",{words:[e[0],e[1]],view:"choice-board"})}function t(){var a;e[0]=null,e[1]=null,n(0),n(1),E.log("choice_cleared",{}),(a=window.CommDB)==null||a.logEvent("clear_board",{words:[],view:"choice-board"})}function s(a){const r=document.getElementById("choice-bank");r.innerHTML="",a.forEach(o=>{const c=document.createElement("div");c.className="bank-item",c.setAttribute("role","button"),c.setAttribute("aria-label",o),c.dataset.word=o;const m=document.createElement("img");m.alt=o;const l=document.createElement("span");l.className="item-label",l.textContent=o,c.appendChild(m),c.appendChild(l),r.appendChild(c),L.load(m,o.toLowerCase()),c.addEventListener("click",()=>i(o))})}function u(){let a;try{const r=localStorage.getItem(f.LS_VOCAB_KEY);a=r?JSON.parse(r):f.BANK_ITEMS.map(o=>o.toLowerCase())}catch{a=f.BANK_ITEMS.map(o=>o.toLowerCase())}s(a),document.getElementById("slot-1").addEventListener("click",()=>{var r;e[0]&&(b.speak(e[0]),(r=window.CommDB)==null||r.logEvent("single_word",{words:[e[0]],view:"choice-board"}))}),document.getElementById("slot-2").addEventListener("click",()=>{var r;e[1]&&(b.speak(e[1]),(r=window.CommDB)==null||r.logEvent("single_word",{words:[e[1]],view:"choice-board"}))}),document.getElementById("btn-clear").addEventListener("click",t)}function g(a){[0,1].forEach(r=>{e[r]=null,n(r)}),s(a)}return{init:u,rebuild:g}})(),j=(()=>{function e(){f.TURN_VOCAB.forEach(d=>{const n=d.replace("-"," "),i=document.getElementById(`btn-${d}`),t=document.getElementById(`img-${d}`);L.load(t,d),i.addEventListener("click",()=>{var s;b.speak(n),E.log("vocabulary_use",{word:n,category:"turn_taking"}),(s=window.CommDB)==null||s.logEvent("single_word",{words:[n],view:"turn-taking"})})})}return{init:e}})(),M=(()=>{function e(){const n=document.getElementById("orientation-warning");window.innerWidth<window.innerHeight?n.classList.add("visible"):n.classList.remove("visible")}function d(){e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",e)}return{init:d}})(),N=(()=>{async function e(){const t=document.getElementById("aos-db-summary");if(t)try{const s=await CommDB.getAll();if(s.length===0){t.textContent="No interactions stored yet.";return}const u=s.reduce((a,r)=>r.timestamp<a?r.timestamp:a,s[0].timestamp),g=new Date(u).toLocaleDateString();t.textContent=`Currently storing ${s.length} interaction${s.length!==1?"s":""} since ${g}.`}catch{t.textContent="Unable to read database."}}async function d(){try{const t=await generateOSPayload(),s=JSON.stringify(t,null,2),u=new Blob([s],{type:"application/json"}),g=`taptalk-export-${Date.now()}.json`;if(navigator.canShare)try{const o=new File([u],g,{type:"application/json"});if(navigator.canShare({files:[o]})){await navigator.share({files:[o],title:"TapTalk Export"}),E.log("data_exported",{method:"share",records:t.metrics.totalEvents});return}}catch(o){if(o.name==="AbortError")return}const a=URL.createObjectURL(u),r=document.createElement("a");r.href=a,r.download=g,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a),E.log("data_exported",{method:"download",records:t.metrics.totalEvents})}catch{}}async function n(){if(window.prompt(`This will permanently delete all stored interactions.

Type DELETE to confirm:`)==="DELETE")try{await CommDB.clearAll(),E.log("database_cleared",{}),await e()}catch{}}function i(){document.getElementById("aos-export-btn").addEventListener("click",d),document.getElementById("aos-clear-btn").addEventListener("click",n)}return{init:i,refresh:e}})(),P=(()=>{const e=["i","you","he","she","it","we","they","me","my","your","that","go","stop","want","help","play","eat","drink","see","come","like","need","get","make","do","have","look","feel","put","sit","stand","open","close","give","take","push","pull","throw","jump","walk","read","in","on","up","down","out","off","here","there","with","away","good","bad","big","little","hot","cold","fast","slow","dirty","clean","loud","quiet","different","same","favorite","broken","more","done","finished","again","mine","what","where","when","why","who","how","bathroom","water","food","home","school","car","bed","book","ball","music","outside","inside","chair","table","yes","no","please","wait","sorry","no-thank-you","all-done","i-dont-know","good-job","red","blue","green","yellow","orange","purple","pink","happy","sad","mad","tired","hungry","thirsty","sick","hurt","my-turn","your-turn","rocks","coloring","math","writing"];let d=[],n=null;const i=3e3;function t(){try{const l=localStorage.getItem(f.LS_VOCAB_KEY);if(l)return JSON.parse(l)}catch{}return f.BANK_ITEMS.map(l=>l.toLowerCase())}async function s(){try{const l=await fetch("./aac-images/vocabulary.json");if(l.ok){const p=await l.json();if(Array.isArray(p)&&p.length>0)return p}}catch{}return e}function u(){s().then(l=>{d=l,a(),document.getElementById("settings-search").value="",r(l,""),N.refresh(),document.getElementById("settings-modal").classList.add("open")})}function g(){document.getElementById("settings-modal").classList.remove("open")}function a(){var C;const l=document.getElementById("voice-select"),p=((C=window.speechSynthesis)==null?void 0:C.getVoices())??[],w=localStorage.getItem(f.LS_VOICE_KEY)||"";l.innerHTML="";const y=document.createElement("option");y.value="",y.textContent="Default voice",l.appendChild(y),p.forEach(h=>{const S=document.createElement("option");S.value=h.voiceURI,S.textContent=`${h.name} (${h.lang})`,h.voiceURI===w&&(S.selected=!0),l.appendChild(S)})}function r(l,p){const w=document.getElementById("settings-word-grid"),y=new Set(t());w.innerHTML="",(p?l.filter(h=>h.includes(p.toLowerCase())):l).forEach(h=>{const S=y.has(h),B=document.createElement("label");B.className="settings-word-item"+(S?" active":"");const _=document.createElement("input");_.type="checkbox",_.className="settings-word-check",_.dataset.word=h,_.checked=S,_.addEventListener("change",()=>B.classList.toggle("active",_.checked));const k=document.createElement("img");k.className="settings-word-img",k.alt=h,L.load(k,h);const T=document.createElement("span");T.className="settings-word-label",T.textContent=h,B.append(_,k,T),w.appendChild(B)})}function o(){const l=Array.from(document.querySelectorAll(".settings-word-check:checked"),p=>p.dataset.word);try{localStorage.setItem(f.LS_VOCAB_KEY,JSON.stringify(l))}catch{}D.rebuild(l),E.log("settings_saved",{activeVocabulary:l}),g()}function c(){const l=document.getElementById("settings-btn");function p(){n=setTimeout(()=>{n=null,u()},i)}function w(){n&&(clearTimeout(n),n=null)}l.addEventListener("pointerdown",p),l.addEventListener("pointerup",w),l.addEventListener("pointerleave",w),l.addEventListener("pointercancel",w),l.addEventListener("contextmenu",y=>y.preventDefault())}function m(){var l;c(),document.getElementById("settings-modal-close").addEventListener("click",g),document.getElementById("settings-save").addEventListener("click",o),document.getElementById("settings-search").addEventListener("input",p=>r(d,p.target.value.trim())),document.getElementById("voice-select").addEventListener("change",p=>{try{localStorage.setItem(f.LS_VOICE_KEY,p.target.value)}catch{}}),(l=window.speechSynthesis)==null||l.addEventListener("voiceschanged",()=>{document.getElementById("settings-modal").classList.contains("open")&&a()})}return{init:m,getActiveVocab:t}})();function U(){"serviceWorker"in navigator?navigator.serviceWorker.register("./sw.js").then(e=>{v.setSwStatus("active âœ“",!0)}).catch(e=>{v.setSwStatus("failed âœ—",!1)}):v.setSwStatus("unsupported",!1)}async function q(){U();try{await E.open(),v.setDbStatus(!0)}catch{v.setDbStatus(!1)}$.init(),O.init(),b.init(),R.init(),D.init(),j.init(),v.init(),M.init(),P.init(),N.init(),E.log("session_start",{sessionId:I,appVersion:"1.0.0",userAgent:navigator.userAgent})}window.TapTalk={version:"1.0.0",getSessionId:()=>I,exportData:()=>E.getAll()};window.PartnerMode=O;document.addEventListener("DOMContentLoaded",q);
