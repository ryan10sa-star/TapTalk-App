(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function n(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(t){if(t.ep)return;t.ep=!0;const o=n(t);fetch(t.href,o)}})();const R="TapTalkDB",v="comm_events";let C=null;async function D(){return C||new Promise((e,a)=>{const n=indexedDB.open(R,1);n.onupgradeneeded=r=>{const t=r.target.result;t.objectStoreNames.contains(v)||t.createObjectStore(v,{keyPath:"id",autoIncrement:!0})},n.onsuccess=r=>{C=r.target.result,e(C)},n.onerror=r=>{console.warn("[TapTalkDB] Open error â€” logging disabled, app continues normally:",r.target.error),a(r.target.error)}})}const x={async logEvent(e,a){var r;const n={timestamp:new Date().toISOString(),eventType:e,words:Array.isArray(a.words)?a.words:[],view:a.view||"",user:(r=window.PartnerMode)!=null&&r.isActive()?"partner":"student"};try{(await D()).transaction(v,"readwrite").objectStore(v).add(n)}catch(t){console.warn("[TapTalkDB] logEvent failed â€” app continues normally:",t)}},async getAll(){const e=await D();return new Promise((a,n)=>{const t=e.transaction(v,"readonly").objectStore(v).getAll();t.onsuccess=()=>a(t.result),t.onerror=()=>n(t.error)})},async clearAll(){const e=await D();return new Promise((a,n)=>{const t=e.transaction(v,"readwrite").objectStore(v).clear();t.onsuccess=()=>a(),t.onerror=()=>n(t.error)})}};window.CommDB=x;window.exportTapTalkData=async function(){const e=await x.getAll(),a=JSON.stringify(e,null,2);return console.log("[TapTalkDB] exportTapTalkData ("+e.length+` records):
`,a),a};async function j(){const e=await CommDB.getAll(),a=e.filter(r=>r.user==="student").length,n=e.filter(r=>r.user==="partner").length;return{source:"TapTalk_AAC",version:"1.0",exportDate:new Date().toISOString(),metrics:{totalEvents:e.length,studentEvents:a,partnerModeEvents:n},logs:e}}window.generateOSPayload=j;function M(){try{const e=localStorage.getItem(p.LS_VOCAB_KEY);if(e)return JSON.parse(e)}catch{}return[]}window.getVocab=M;const p=Object.freeze({DB_NAME:"taptalk-db",DB_VERSION:1,STORE_EVENTS:"events",BANK_ITEMS:["Rocks","Ball","Walk","Coloring","Book","Math","Writing"],CORE_VOCAB:["Yes","No"],TURN_VOCAB:["my-turn","your-turn"],LS_VOCAB_KEY:"activeVocabulary",LS_VOICE_KEY:"selectedVoiceURI"}),T=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`session-${Date.now()}-${Math.random().toString(36).slice(2)}`,N=(()=>{let e=!1;function a(){return e}function n(){const o=document.getElementById("app"),d=document.getElementById("partner-mode-toggle");e?(o.classList.add("partner-mode"),d.textContent="ðŸ”“",d.setAttribute("aria-pressed","true"),d.title="Partner Mode ON â€” tap to disable"):(o.classList.remove("partner-mode"),d.textContent="ðŸ”’",d.setAttribute("aria-pressed","false"),d.title="Enable Partner Mode")}function r(){e=!e,n(),h.log("partner_mode_changed",{active:e})}function t(){document.getElementById("partner-mode-toggle").addEventListener("click",r),n()}return{isActive:a,init:t}})(),h=(()=>{let e=null;function a(){return new Promise((t,o)=>{const d=indexedDB.open(p.DB_NAME,p.DB_VERSION);d.onupgradeneeded=m=>{const l=m.target.result;if(!l.objectStoreNames.contains(p.STORE_EVENTS)){const c=l.createObjectStore(p.STORE_EVENTS,{keyPath:"id",autoIncrement:!0});c.createIndex("timestamp","timestamp",{unique:!1}),c.createIndex("sessionId","sessionId",{unique:!1}),c.createIndex("type","type",{unique:!1})}},d.onsuccess=m=>{e=m.target.result,t(e)},d.onerror=m=>{o(m.target.error)}})}function n(t,o){const d={timestamp:new Date().toISOString(),sessionId:T,type:t,data:o,user:N.isActive()?"partner":"student"};if(!e){y.append({...d,id:"pending"});return}const c=e.transaction(p.STORE_EVENTS,"readwrite").objectStore(p.STORE_EVENTS).add(d);c.onsuccess=s=>{d.id=s.target.result,y.append(d)},c.onerror=()=>{}}function r(){return new Promise((t,o)=>{if(!e)return o(new Error("DB not ready"));const m=e.transaction(p.STORE_EVENTS,"readonly").objectStore(p.STORE_EVENTS).getAll();m.onsuccess=()=>t(m.result),m.onerror=()=>o(m.error)})}return{open:a,log:n,getAll:r}})(),L=(()=>{let e=!1;function a(){if(e||!window.speechSynthesis)return;e=!0;const t=new SpeechSynthesisUtterance("");t.volume=0,window.speechSynthesis.speak(t)}function n(t){if(!window.speechSynthesis)return;window.speechSynthesis.cancel();const o=new SpeechSynthesisUtterance(t);o.rate=.9,o.pitch=1,o.volume=1;try{const d=localStorage.getItem(p.LS_VOICE_KEY);if(d){const m=window.speechSynthesis.getVoices().find(l=>l.voiceURI===d);m&&(o.voice=m)}}catch{}window.speechSynthesis.speak(o)}function r(){window.addEventListener("load",()=>{var t;return(t=window.speechSynthesis)==null?void 0:t.getVoices()}),document.addEventListener("pointerdown",a,{once:!0,capture:!0})}return{speak:n,init:r}})(),B=(()=>{window.location.hostname.includes("github.io");function e(r){return`./aac-images/${r.toLowerCase()}.png`}function a(r,t){r.src=`./aac-images/${t.toLowerCase()}.png`,r.alt=t,r.onerror=null}function n(r){return e(r)}return{load:a,getCachedUrl:n}})(),y=(()=>{const e=()=>document.getElementById("dev-preview-entries"),a=()=>document.getElementById("dev-preview-count");let n=0;function r(){var s;document.getElementById("dev-status-session").textContent=T.slice(0,13)+"â€¦",document.getElementById("dev-status-version").textContent=((s=window.TapTalk)==null?void 0:s.version)??"1.0.0",document.getElementById("dev-preview-clear").addEventListener("click",()=>{e().innerHTML="",n=0,t()}),document.getElementById("dev-preview-refresh").addEventListener("click",m),document.getElementById("dev-preview-export").addEventListener("click",async()=>{var u;try{const f=await((u=window.exportTapTalkData)==null?void 0:u.call(window));if(!f)return;const i=new Blob([f],{type:"application/json"}),g=URL.createObjectURL(i),w=document.createElement("a");w.href=g,w.download=`taptalk-export-${Date.now()}.json`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(g)}catch{}})}function t(){a().textContent=`${n} event${n!==1?"s":""} logged`}function o(s){const u=document.createElement("div");u.className="dev-log-entry";const f=new Date(s.timestamp).toLocaleTimeString(),i=s.id!=null?`[${s.id}] `:"";return u.innerHTML=`<span class="log-time">${f}</span><span class="log-type">${i}${s.type}</span>${JSON.stringify(s.data)}`,u}function d(s){n++,t(),e().prepend(o(s))}async function m(){try{const s=await h.getAll();e().innerHTML="",n=s.length,t(),[...s].reverse().forEach(u=>e().appendChild(o(u)))}catch{}}function l(s){const u=document.getElementById("dev-status-db");u.textContent=s?"open âœ“":"error âœ—",u.className="dev-status-value "+(s?"dev-status-ok":"dev-status-err")}function c(s,u){const f=document.getElementById("dev-status-sw");f.textContent=s,f.className="dev-status-value "+(u?"dev-status-ok":"dev-status-err")}return{init:r,append:d,setDbStatus:l,setSwStatus:c}})(),P=(()=>{function e(n){document.querySelectorAll(".view").forEach(r=>r.classList.remove("active")),document.querySelectorAll(".nav-btn").forEach(r=>r.classList.remove("active")),document.getElementById(`view-${n}`).classList.add("active"),document.querySelector(`.nav-btn[data-view="${n}"]`).classList.add("active"),h.log("view_changed",{view:n})}function a(){document.querySelectorAll(".nav-btn").forEach(n=>{n.addEventListener("click",()=>e(n.dataset.view))})}return{init:a,switchTo:e}})(),U=(()=>{function e(){["yes","no"].forEach(n=>{const r=document.getElementById(`btn-${n}`),t=document.getElementById(`img-${n}`);B.load(t,n),r.addEventListener("click",()=>{var o;L.speak(n),h.log("vocabulary_use",{word:n,category:"core_vocab"}),(o=window.CommDB)==null||o.logEvent("single_word",{words:[n],view:"core-vocab"})})})}return{init:e}})(),V=(()=>{const e=[null,null];function a(l,c){const s=document.getElementById(`slot-${l+1}`);s.classList.remove("empty"),s.innerHTML="";const u=document.createElement("img");u.alt=c,s.appendChild(u),B.load(u,c);const f=document.createElement("span");f.className="slot-label",f.textContent=c,s.appendChild(f)}function n(l){const c=document.getElementById(`slot-${l+1}`);c.classList.add("empty"),c.innerHTML='<span class="slot-placeholder">?</span>'}function r(l){var c,s;if(e[0]===null)e[0]=l,a(0,l),h.log("choice_slot_filled",{slot:1,word:l});else if(e[1]===null){e[1]=l,a(1,l);const u=`${e[0]} or ${e[1]}`;L.speak(u),h.log("choice_made",{choice1:e[0],choice2:e[1],phrase:u}),(c=window.CommDB)==null||c.logEvent("sentence_formed",{words:[e[0],e[1]],view:"choice-board"})}else L.speak(`${e[0]} or ${e[1]}`),(s=window.CommDB)==null||s.logEvent("sentence_formed",{words:[e[0],e[1]],view:"choice-board"})}function t(){var l;e[0]=null,e[1]=null,n(0),n(1),h.log("choice_cleared",{}),(l=window.CommDB)==null||l.logEvent("clear_board",{words:[],view:"choice-board"})}function o(l){const c=document.getElementById("choice-bank");c.innerHTML="",l.forEach(s=>{const u=document.createElement("div");u.className="bank-item",u.setAttribute("role","button"),u.setAttribute("aria-label",s),u.dataset.word=s;const f=document.createElement("img");f.alt=s;const i=document.createElement("span");i.className="item-label",i.textContent=s,u.appendChild(f),u.appendChild(i),c.appendChild(u),B.load(f,s),u.addEventListener("click",()=>r(s))})}function d(){let l;try{const c=localStorage.getItem(p.LS_VOCAB_KEY);l=c?JSON.parse(c):p.BANK_ITEMS.map(s=>s.toLowerCase())}catch{l=p.BANK_ITEMS.map(s=>s.toLowerCase())}o(l),document.getElementById("slot-1").addEventListener("click",()=>{var c;e[0]&&(L.speak(e[0]),(c=window.CommDB)==null||c.logEvent("single_word",{words:[e[0]],view:"choice-board"}))}),document.getElementById("slot-2").addEventListener("click",()=>{var c;e[1]&&(L.speak(e[1]),(c=window.CommDB)==null||c.logEvent("single_word",{words:[e[1]],view:"choice-board"}))}),document.getElementById("btn-clear").addEventListener("click",t)}function m(l){[0,1].forEach(c=>{e[c]=null,n(c)}),o(l)}return{init:d,rebuild:m}})(),q=(()=>{function e(){p.TURN_VOCAB.forEach(a=>{const n=a.replace("-"," "),r=document.getElementById(`btn-${a}`),t=document.getElementById(`img-${a}`);B.load(t,a),r.addEventListener("click",()=>{var o;L.speak(n),h.log("vocabulary_use",{word:n,category:"turn_taking"}),(o=window.CommDB)==null||o.logEvent("single_word",{words:[n],view:"turn-taking"})})})}return{init:e}})(),K=(()=>{function e(){const n=document.getElementById("orientation-warning");window.innerWidth<window.innerHeight?n.classList.add("visible"):n.classList.remove("visible")}function a(){e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",e)}return{init:a}})(),$=(()=>{async function e(){const t=document.getElementById("aos-db-summary");if(t)try{const o=await CommDB.getAll();if(o.length===0){t.textContent="No interactions stored yet.";return}const d=o.reduce((l,c)=>c.timestamp<l?c.timestamp:l,o[0].timestamp),m=new Date(d).toLocaleDateString();t.textContent=`Currently storing ${o.length} interaction${o.length!==1?"s":""} since ${m}.`}catch{t.textContent="Unable to read database."}}async function a(){try{const t=await generateOSPayload(),o=JSON.stringify(t,null,2),d=new Blob([o],{type:"application/json"}),m=`taptalk-export-${Date.now()}.json`;if(navigator.canShare)try{const s=new File([d],m,{type:"application/json"});if(navigator.canShare({files:[s]})){await navigator.share({files:[s],title:"TapTalk Export"}),h.log("data_exported",{method:"share",records:t.metrics.totalEvents});return}}catch(s){if(s.name==="AbortError")return}const l=URL.createObjectURL(d),c=document.createElement("a");c.href=l,c.download=m,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(l),h.log("data_exported",{method:"download",records:t.metrics.totalEvents})}catch{}}async function n(){if(window.prompt(`This will permanently delete all stored interactions.

Type DELETE to confirm:`)==="DELETE")try{await CommDB.clearAll(),h.log("database_cleared",{}),await e()}catch{}}function r(){document.getElementById("aos-export-btn").addEventListener("click",a),document.getElementById("aos-clear-btn").addEventListener("click",n)}return{init:r,refresh:e}})(),Y=(()=>{const e=["i","you","he","she","it","we","they","me","my","your","that","go","stop","want","help","play","eat","drink","see","come","like","need","get","make","do","have","look","feel","put","sit","stand","open","close","give","take","push","pull","throw","jump","walk","read","in","on","up","down","out","off","here","there","with","away","good","bad","big","little","hot","cold","fast","slow","dirty","clean","loud","quiet","different","same","favorite","broken","more","done","finished","again","mine","what","where","when","why","who","how","bathroom","water","food","home","school","car","bed","book","ball","music","outside","inside","chair","table","yes","no","please","wait","sorry","no-thank-you","all-done","i-dont-know","good-job","red","blue","green","yellow","orange","purple","pink","happy","sad","mad","tired","hungry","thirsty","sick","hurt","my-turn","your-turn","rocks","coloring","math","writing"];let a=[],n=null;const r=3e3;function t(){try{const i=localStorage.getItem(p.LS_VOCAB_KEY);if(i)return JSON.parse(i)}catch{}return p.BANK_ITEMS.map(i=>i.toLowerCase())}async function o(){try{const i=await fetch("./aac-images/vocabulary.json");if(i.ok){const g=await i.json();if(Array.isArray(g)&&g.length>0)return g}}catch{}return e}function d(){o().then(i=>{a=i,l(),document.getElementById("settings-search").value="",c(i,""),$.refresh(),document.getElementById("settings-modal").classList.add("open")})}function m(){document.getElementById("settings-modal").classList.remove("open")}function l(){var O;const i=document.getElementById("voice-select"),g=((O=window.speechSynthesis)==null?void 0:O.getVoices())??[],w=localStorage.getItem(p.LS_VOICE_KEY)||"";i.innerHTML="";const S=document.createElement("option");S.value="",S.textContent="Default voice",i.appendChild(S),g.forEach(E=>{const b=document.createElement("option");b.value=E.voiceURI,b.textContent=`${E.name} (${E.lang})`,E.voiceURI===w&&(b.selected=!0),i.appendChild(b)})}function c(i,g){const w=document.getElementById("settings-word-grid"),S=new Set(t());w.innerHTML="",(g?i.filter(E=>E.includes(g.toLowerCase())):i).forEach(E=>{const b=S.has(E),k=document.createElement("label");k.className="settings-word-item"+(b?" active":"");const _=document.createElement("input");_.type="checkbox",_.className="settings-word-check",_.dataset.word=E,_.checked=b,_.addEventListener("change",()=>k.classList.toggle("active",_.checked));const I=document.createElement("img");I.className="settings-word-img",I.alt=E,B.load(I,E);const A=document.createElement("span");A.className="settings-word-label",A.textContent=E,k.append(_,I,A),w.appendChild(k)})}function s(){const i=Array.from(document.querySelectorAll(".settings-word-check:checked"),g=>g.dataset.word);try{localStorage.setItem(p.LS_VOCAB_KEY,JSON.stringify(i))}catch{}V.rebuild(i),h.log("settings_saved",{activeVocabulary:i}),m()}function u(){const i=document.getElementById("settings-btn");function g(){n=setTimeout(()=>{n=null,d()},r)}function w(){n&&(clearTimeout(n),n=null)}i.addEventListener("pointerdown",g),i.addEventListener("pointerup",w),i.addEventListener("pointerleave",w),i.addEventListener("pointercancel",w),i.addEventListener("contextmenu",S=>S.preventDefault())}function f(){var i;u(),document.getElementById("settings-modal-close").addEventListener("click",m),document.getElementById("settings-save").addEventListener("click",s),document.getElementById("settings-search").addEventListener("input",g=>c(a,g.target.value.trim())),document.getElementById("voice-select").addEventListener("change",g=>{try{localStorage.setItem(p.LS_VOICE_KEY,g.target.value)}catch{}}),(i=window.speechSynthesis)==null||i.addEventListener("voiceschanged",()=>{document.getElementById("settings-modal").classList.contains("open")&&l()})}return{init:f,getActiveVocab:t}})();function H(){"serviceWorker"in navigator?navigator.serviceWorker.register("./sw.js").then(e=>{y.setSwStatus("active âœ“",!0)}).catch(e=>{y.setSwStatus("failed âœ—",!1)}):y.setSwStatus("unsupported",!1)}async function W(){H();try{await h.open(),y.setDbStatus(!0)}catch{y.setDbStatus(!1)}P.init(),N.init(),L.init(),U.init(),V.init(),q.init(),y.init(),K.init(),Y.init(),$.init(),h.log("session_start",{sessionId:T,appVersion:"1.0.0",userAgent:navigator.userAgent})}window.TapTalk={version:"1.0.0",getSessionId:()=>T,exportData:()=>h.getAll()};window.PartnerMode=N;document.addEventListener("DOMContentLoaded",W);
