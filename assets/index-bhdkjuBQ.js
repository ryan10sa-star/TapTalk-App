(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(t){if(t.ep)return;t.ep=!0;const o=n(t);fetch(t.href,o)}})();const R="TapTalkDB",y="comm_events";let C=null;async function x(){return C||new Promise((e,c)=>{const n=indexedDB.open(R,1);n.onupgradeneeded=i=>{const t=i.target.result;t.objectStoreNames.contains(y)||t.createObjectStore(y,{keyPath:"id",autoIncrement:!0})},n.onsuccess=i=>{C=i.target.result,e(C)},n.onerror=i=>{console.warn("[TapTalkDB] Open error â€” logging disabled, app continues normally:",i.target.error),c(i.target.error)}})}const N={async logEvent(e,c){var i;const n={timestamp:new Date().toISOString(),eventType:e,words:Array.isArray(c.words)?c.words:[],view:c.view||"",user:(i=window.PartnerMode)!=null&&i.isActive()?"partner":"student"};try{(await x()).transaction(y,"readwrite").objectStore(y).add(n)}catch(t){console.warn("[TapTalkDB] logEvent failed â€” app continues normally:",t)}},async getAll(){const e=await x();return new Promise((c,n)=>{const t=e.transaction(y,"readonly").objectStore(y).getAll();t.onsuccess=()=>c(t.result),t.onerror=()=>n(t.error)})},async clearAll(){const e=await x();return new Promise((c,n)=>{const t=e.transaction(y,"readwrite").objectStore(y).clear();t.onsuccess=()=>c(),t.onerror=()=>n(t.error)})}};window.CommDB=N;window.exportTapTalkData=async function(){const e=await N.getAll(),c=JSON.stringify(e,null,2);return console.log("[TapTalkDB] exportTapTalkData ("+e.length+` records):
`,c),c};async function j(){const e=await CommDB.getAll(),c=e.filter(i=>i.user==="student").length,n=e.filter(i=>i.user==="partner").length;return{source:"TapTalk_AAC",version:"1.0",exportDate:new Date().toISOString(),metrics:{totalEvents:e.length,studentEvents:c,partnerModeEvents:n},logs:e}}window.generateOSPayload=j;function M(){try{const e=localStorage.getItem(p.LS_VOCAB_KEY);if(e)return JSON.parse(e)}catch{}return[]}window.getVocab=M;const p=Object.freeze({DB_NAME:"taptalk-db",DB_VERSION:1,STORE_EVENTS:"events",BANK_ITEMS:["Rocks","Ball","Walk","Coloring","Book","Math","Writing"],CORE_VOCAB:["Yes","No"],TURN_VOCAB:["my-turn","your-turn"],LS_VOCAB_KEY:"activeVocabulary",LS_VOICE_KEY:"selectedVoiceURI"}),T=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`session-${Date.now()}-${Math.random().toString(36).slice(2)}`,D=(()=>{let e=!1;function c(){return e}function n(){const o=document.getElementById("app"),s=document.getElementById("partner-mode-toggle");e?(o.classList.add("partner-mode"),s.textContent="ðŸ”“",s.setAttribute("aria-pressed","true"),s.title="Partner Mode ON â€” tap to disable"):(o.classList.remove("partner-mode"),s.textContent="ðŸ”’",s.setAttribute("aria-pressed","false"),s.title="Enable Partner Mode")}function i(){e=!e,n(),w.log("partner_mode_changed",{active:e})}function t(){document.getElementById("partner-mode-toggle").addEventListener("click",i),n()}return{isActive:c,init:t}})(),w=(()=>{let e=null;function c(){return new Promise((t,o)=>{const s=indexedDB.open(p.DB_NAME,p.DB_VERSION);s.onupgradeneeded=u=>{const d=u.target.result;if(!d.objectStoreNames.contains(p.STORE_EVENTS)){const a=d.createObjectStore(p.STORE_EVENTS,{keyPath:"id",autoIncrement:!0});a.createIndex("timestamp","timestamp",{unique:!1}),a.createIndex("sessionId","sessionId",{unique:!1}),a.createIndex("type","type",{unique:!1})}},s.onsuccess=u=>{e=u.target.result,t(e)},s.onerror=u=>{o(u.target.error)}})}function n(t,o){const s={timestamp:new Date().toISOString(),sessionId:T,type:t,data:o,user:D.isActive()?"partner":"student"};if(!e){E.append({...s,id:"pending"});return}const a=e.transaction(p.STORE_EVENTS,"readwrite").objectStore(p.STORE_EVENTS).add(s);a.onsuccess=r=>{s.id=r.target.result,E.append(s)},a.onerror=()=>{}}function i(){return new Promise((t,o)=>{if(!e)return o(new Error("DB not ready"));const u=e.transaction(p.STORE_EVENTS,"readonly").objectStore(p.STORE_EVENTS).getAll();u.onsuccess=()=>t(u.result),u.onerror=()=>o(u.error)})}return{open:c,log:n,getAll:i}})(),L=(()=>{let e=!1;function c(){if(e||!window.speechSynthesis)return;e=!0;const t=new SpeechSynthesisUtterance("");t.volume=0,window.speechSynthesis.speak(t)}function n(t){if(!window.speechSynthesis)return;window.speechSynthesis.cancel();const o=new SpeechSynthesisUtterance(t);o.rate=.9,o.pitch=1,o.volume=1;try{const s=localStorage.getItem(p.LS_VOICE_KEY);if(s){const u=window.speechSynthesis.getVoices().find(d=>d.voiceURI===s);u&&(o.voice=u)}}catch{}window.speechSynthesis.speak(o)}function i(){window.addEventListener("load",()=>{var t;return(t=window.speechSynthesis)==null?void 0:t.getVoices()}),document.addEventListener("pointerdown",c,{once:!0,capture:!0})}return{speak:n,init:i}})(),B=(()=>{function e(s,u){const d=u.charAt(0).toUpperCase(),r=`<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100'><rect width='100' height='100' rx='18' fill='${`hsl(${u.charCodeAt(0)*37%360}, 70%, 60%)`}'/><text x='50' y='62' text-anchor='middle' font-size='56' fill='#fff' font-family='Arial' dy='.3em'>${d}</text></svg>`;s.src="data:image/svg+xml;utf8,"+encodeURIComponent(r),s.alt=u}const n=window.location.hostname.includes("github.io")?"TapTalk-App/":"";function i(s){return`${n}aac-images/${s.toLowerCase()}`}function t(s,u){s.src=i(u),s.onerror=()=>{s.onerror=null,e(s,u)}}function o(s){return i(s)}return{load:t,getCachedUrl:o}})(),E=(()=>{const e=()=>document.getElementById("dev-preview-entries"),c=()=>document.getElementById("dev-preview-count");let n=0;function i(){var r;document.getElementById("dev-status-session").textContent=T.slice(0,13)+"â€¦",document.getElementById("dev-status-version").textContent=((r=window.TapTalk)==null?void 0:r.version)??"1.0.0",document.getElementById("dev-preview-clear").addEventListener("click",()=>{e().innerHTML="",n=0,t()}),document.getElementById("dev-preview-refresh").addEventListener("click",u),document.getElementById("dev-preview-export").addEventListener("click",async()=>{var m;try{const f=await((m=window.exportTapTalkData)==null?void 0:m.call(window));if(!f)return;const l=new Blob([f],{type:"application/json"}),g=URL.createObjectURL(l),h=document.createElement("a");h.href=g,h.download=`taptalk-export-${Date.now()}.json`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(g)}catch{}})}function t(){c().textContent=`${n} event${n!==1?"s":""} logged`}function o(r){const m=document.createElement("div");m.className="dev-log-entry";const f=new Date(r.timestamp).toLocaleTimeString(),l=r.id!=null?`[${r.id}] `:"";return m.innerHTML=`<span class="log-time">${f}</span><span class="log-type">${l}${r.type}</span>${JSON.stringify(r.data)}`,m}function s(r){n++,t(),e().prepend(o(r))}async function u(){try{const r=await w.getAll();e().innerHTML="",n=r.length,t(),[...r].reverse().forEach(m=>e().appendChild(o(m)))}catch{}}function d(r){const m=document.getElementById("dev-status-db");m.textContent=r?"open âœ“":"error âœ—",m.className="dev-status-value "+(r?"dev-status-ok":"dev-status-err")}function a(r,m){const f=document.getElementById("dev-status-sw");f.textContent=r,f.className="dev-status-value "+(m?"dev-status-ok":"dev-status-err")}return{init:i,append:s,setDbStatus:d,setSwStatus:a}})(),P=(()=>{function e(n){document.querySelectorAll(".view").forEach(i=>i.classList.remove("active")),document.querySelectorAll(".nav-btn").forEach(i=>i.classList.remove("active")),document.getElementById(`view-${n}`).classList.add("active"),document.querySelector(`.nav-btn[data-view="${n}"]`).classList.add("active"),w.log("view_changed",{view:n})}function c(){document.querySelectorAll(".nav-btn").forEach(n=>{n.addEventListener("click",()=>e(n.dataset.view))})}return{init:c,switchTo:e}})(),U=(()=>{function e(){["yes","no"].forEach(n=>{const i=document.getElementById(`btn-${n}`),t=document.getElementById(`img-${n}`);B.load(t,n),i.addEventListener("click",()=>{var o;L.speak(n),w.log("vocabulary_use",{word:n,category:"core_vocab"}),(o=window.CommDB)==null||o.logEvent("single_word",{words:[n],view:"core-vocab"})})})}return{init:e}})(),V=(()=>{const e=[null,null];function c(d,a){const r=document.getElementById(`slot-${d+1}`);r.classList.remove("empty"),r.innerHTML="";const m=document.createElement("img");m.alt=a,r.appendChild(m),B.load(m,a);const f=document.createElement("span");f.className="slot-label",f.textContent=a,r.appendChild(f)}function n(d){const a=document.getElementById(`slot-${d+1}`);a.classList.add("empty"),a.innerHTML='<span class="slot-placeholder">?</span>'}function i(d){var a,r;if(e[0]===null)e[0]=d,c(0,d),w.log("choice_slot_filled",{slot:1,word:d});else if(e[1]===null){e[1]=d,c(1,d);const m=`${e[0]} or ${e[1]}`;L.speak(m),w.log("choice_made",{choice1:e[0],choice2:e[1],phrase:m}),(a=window.CommDB)==null||a.logEvent("sentence_formed",{words:[e[0],e[1]],view:"choice-board"})}else L.speak(`${e[0]} or ${e[1]}`),(r=window.CommDB)==null||r.logEvent("sentence_formed",{words:[e[0],e[1]],view:"choice-board"})}function t(){var d;e[0]=null,e[1]=null,n(0),n(1),w.log("choice_cleared",{}),(d=window.CommDB)==null||d.logEvent("clear_board",{words:[],view:"choice-board"})}function o(d){const a=document.getElementById("choice-bank");a.innerHTML="",d.forEach(r=>{const m=document.createElement("div");m.className="bank-item",m.setAttribute("role","button"),m.setAttribute("aria-label",r),m.dataset.word=r;const f=document.createElement("img");f.alt=r;const l=document.createElement("span");l.className="item-label",l.textContent=r,m.appendChild(f),m.appendChild(l),a.appendChild(m),B.load(f,r),m.addEventListener("click",()=>i(r))})}function s(){let d;try{const a=localStorage.getItem(p.LS_VOCAB_KEY);d=a?JSON.parse(a):p.BANK_ITEMS.map(r=>r.toLowerCase())}catch{d=p.BANK_ITEMS.map(r=>r.toLowerCase())}o(d),document.getElementById("slot-1").addEventListener("click",()=>{var a;e[0]&&(L.speak(e[0]),(a=window.CommDB)==null||a.logEvent("single_word",{words:[e[0]],view:"choice-board"}))}),document.getElementById("slot-2").addEventListener("click",()=>{var a;e[1]&&(L.speak(e[1]),(a=window.CommDB)==null||a.logEvent("single_word",{words:[e[1]],view:"choice-board"}))}),document.getElementById("btn-clear").addEventListener("click",t)}function u(d){[0,1].forEach(a=>{e[a]=null,n(a)}),o(d)}return{init:s,rebuild:u}})(),q=(()=>{function e(){p.TURN_VOCAB.forEach(c=>{const n=c.replace("-"," "),i=document.getElementById(`btn-${c}`),t=document.getElementById(`img-${c}`);B.load(t,c),i.addEventListener("click",()=>{var o;L.speak(n),w.log("vocabulary_use",{word:n,category:"turn_taking"}),(o=window.CommDB)==null||o.logEvent("single_word",{words:[n],view:"turn-taking"})})})}return{init:e}})(),K=(()=>{function e(){const n=document.getElementById("orientation-warning");window.innerWidth<window.innerHeight?n.classList.add("visible"):n.classList.remove("visible")}function c(){e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",e)}return{init:c}})(),$=(()=>{async function e(){const t=document.getElementById("aos-db-summary");if(t)try{const o=await CommDB.getAll();if(o.length===0){t.textContent="No interactions stored yet.";return}const s=o.reduce((d,a)=>a.timestamp<d?a.timestamp:d,o[0].timestamp),u=new Date(s).toLocaleDateString();t.textContent=`Currently storing ${o.length} interaction${o.length!==1?"s":""} since ${u}.`}catch{t.textContent="Unable to read database."}}async function c(){try{const t=await generateOSPayload(),o=JSON.stringify(t,null,2),s=new Blob([o],{type:"application/json"}),u=`taptalk-export-${Date.now()}.json`;if(navigator.canShare)try{const r=new File([s],u,{type:"application/json"});if(navigator.canShare({files:[r]})){await navigator.share({files:[r],title:"TapTalk Export"}),w.log("data_exported",{method:"share",records:t.metrics.totalEvents});return}}catch(r){if(r.name==="AbortError")return}const d=URL.createObjectURL(s),a=document.createElement("a");a.href=d,a.download=u,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(d),w.log("data_exported",{method:"download",records:t.metrics.totalEvents})}catch{}}async function n(){if(window.prompt(`This will permanently delete all stored interactions.

Type DELETE to confirm:`)==="DELETE")try{await CommDB.clearAll(),w.log("database_cleared",{}),await e()}catch{}}function i(){document.getElementById("aos-export-btn").addEventListener("click",c),document.getElementById("aos-clear-btn").addEventListener("click",n)}return{init:i,refresh:e}})(),H=(()=>{const e=["i","you","he","she","it","we","they","me","my","your","that","go","stop","want","help","play","eat","drink","see","come","like","need","get","make","do","have","look","feel","put","sit","stand","open","close","give","take","push","pull","throw","jump","walk","read","in","on","up","down","out","off","here","there","with","away","good","bad","big","little","hot","cold","fast","slow","dirty","clean","loud","quiet","different","same","favorite","broken","more","done","finished","again","mine","what","where","when","why","who","how","bathroom","water","food","home","school","car","bed","book","ball","music","outside","inside","chair","table","yes","no","please","wait","sorry","no-thank-you","all-done","i-dont-know","good-job","red","blue","green","yellow","orange","purple","pink","happy","sad","mad","tired","hungry","thirsty","sick","hurt","my-turn","your-turn","rocks","coloring","math","writing"];let c=[],n=null;const i=3e3;function t(){try{const l=localStorage.getItem(p.LS_VOCAB_KEY);if(l)return JSON.parse(l)}catch{}return p.BANK_ITEMS.map(l=>l.toLowerCase())}async function o(){try{const l=await fetch("./aac-images/vocabulary.json");if(l.ok){const g=await l.json();if(Array.isArray(g)&&g.length>0)return g}}catch{}return e}function s(){o().then(l=>{c=l,d(),document.getElementById("settings-search").value="",a(l,""),$.refresh(),document.getElementById("settings-modal").classList.add("open")})}function u(){document.getElementById("settings-modal").classList.remove("open")}function d(){var A;const l=document.getElementById("voice-select"),g=((A=window.speechSynthesis)==null?void 0:A.getVoices())??[],h=localStorage.getItem(p.LS_VOICE_KEY)||"";l.innerHTML="";const b=document.createElement("option");b.value="",b.textContent="Default voice",l.appendChild(b),g.forEach(v=>{const S=document.createElement("option");S.value=v.voiceURI,S.textContent=`${v.name} (${v.lang})`,v.voiceURI===h&&(S.selected=!0),l.appendChild(S)})}function a(l,g){const h=document.getElementById("settings-word-grid"),b=new Set(t());h.innerHTML="",(g?l.filter(v=>v.includes(g.toLowerCase())):l).forEach(v=>{const S=b.has(v),k=document.createElement("label");k.className="settings-word-item"+(S?" active":"");const _=document.createElement("input");_.type="checkbox",_.className="settings-word-check",_.dataset.word=v,_.checked=S,_.addEventListener("change",()=>k.classList.toggle("active",_.checked));const I=document.createElement("img");I.className="settings-word-img",I.alt=v,B.load(I,v);const O=document.createElement("span");O.className="settings-word-label",O.textContent=v,k.append(_,I,O),h.appendChild(k)})}function r(){const l=Array.from(document.querySelectorAll(".settings-word-check:checked"),g=>g.dataset.word);try{localStorage.setItem(p.LS_VOCAB_KEY,JSON.stringify(l))}catch{}V.rebuild(l),w.log("settings_saved",{activeVocabulary:l}),u()}function m(){const l=document.getElementById("settings-btn");function g(){n=setTimeout(()=>{n=null,s()},i)}function h(){n&&(clearTimeout(n),n=null)}l.addEventListener("pointerdown",g),l.addEventListener("pointerup",h),l.addEventListener("pointerleave",h),l.addEventListener("pointercancel",h),l.addEventListener("contextmenu",b=>b.preventDefault())}function f(){var l;m(),document.getElementById("settings-modal-close").addEventListener("click",u),document.getElementById("settings-save").addEventListener("click",r),document.getElementById("settings-search").addEventListener("input",g=>a(c,g.target.value.trim())),document.getElementById("voice-select").addEventListener("change",g=>{try{localStorage.setItem(p.LS_VOICE_KEY,g.target.value)}catch{}}),(l=window.speechSynthesis)==null||l.addEventListener("voiceschanged",()=>{document.getElementById("settings-modal").classList.contains("open")&&d()})}return{init:f,getActiveVocab:t}})();function Y(){"serviceWorker"in navigator?navigator.serviceWorker.register("./sw.js").then(e=>{E.setSwStatus("active âœ“",!0)}).catch(e=>{E.setSwStatus("failed âœ—",!1)}):E.setSwStatus("unsupported",!1)}async function W(){Y();try{await w.open(),E.setDbStatus(!0)}catch{E.setDbStatus(!1)}P.init(),D.init(),L.init(),U.init(),V.init(),q.init(),E.init(),K.init(),H.init(),$.init(),w.log("session_start",{sessionId:T,appVersion:"1.0.0",userAgent:navigator.userAgent})}window.TapTalk={version:"1.0.0",getSessionId:()=>T,exportData:()=>w.getAll()};window.PartnerMode=D;document.addEventListener("DOMContentLoaded",W);
