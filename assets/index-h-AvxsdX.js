(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))u(o);new MutationObserver(o=>{for(const t of o)if(t.type==="childList")for(const c of t.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&u(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const t={};return o.integrity&&(t.integrity=o.integrity),o.referrerPolicy&&(t.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?t.credentials="include":o.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function u(o){if(o.ep)return;o.ep=!0;const t=n(o);fetch(o.href,t)}})();const O=(()=>{const e="TapTalkDB",n="comm_events";let u=null;function o(){return u?Promise.resolve(u):new Promise((a,r)=>{const s=indexedDB.open(e,1);s.onupgradeneeded=i=>{const m=i.target.result;m.objectStoreNames.contains(n)||m.createObjectStore(n,{keyPath:"id",autoIncrement:!0})},s.onsuccess=i=>{u=i.target.result,a(u)},s.onerror=i=>{console.warn("[TapTalkDB] Open error â€” logging disabled, app continues normally:",i.target.error),r(i.target.error)}})}async function t(a,r){var i;const s={timestamp:new Date().toISOString(),eventType:a,words:Array.isArray(r.words)?r.words:[],view:r.view||"",user:(i=window.PartnerMode)!=null&&i.isActive()?"partner":"student"};try{(await o()).transaction(n,"readwrite").objectStore(n).add(s)}catch(m){console.warn("[TapTalkDB] logEvent failed â€” app continues normally:",m)}}async function c(){const a=await o();return new Promise((r,s)=>{const m=a.transaction(n,"readonly").objectStore(n).getAll();m.onsuccess=()=>r(m.result),m.onerror=()=>s(m.error)})}async function g(){const a=await o();return new Promise((r,s)=>{const m=a.transaction(n,"readwrite").objectStore(n).clear();m.onsuccess=()=>r(),m.onerror=()=>s(m.error)})}return{logEvent:t,getAll:c,clearAll:g}})();window.CommDB=O;window.exportTapTalkData=async function(){const e=await O.getAll(),d=JSON.stringify(e,null,2);return console.log("[TapTalkDB] exportTapTalkData ("+e.length+` records):
`,d),d};async function N(){const e=await CommDB.getAll(),d=e.filter(u=>u.user==="student").length,n=e.filter(u=>u.user==="partner").length;return{source:"TapTalk_AAC",version:"1.0",exportDate:new Date().toISOString(),metrics:{totalEvents:e.length,studentEvents:d,partnerModeEvents:n},logs:e}}window.generateOSPayload=N;function V(){try{const e=localStorage.getItem(f.LS_VOCAB_KEY);if(e)return JSON.parse(e)}catch{}return[]}window.getVocab=V;const f=Object.freeze({DB_NAME:"taptalk-db",DB_VERSION:1,STORE_EVENTS:"events",BANK_ITEMS:["Rocks","Ball","Walk","Coloring","Book","Math","Writing"],CORE_VOCAB:["Yes","No"],TURN_VOCAB:["my-turn","your-turn"],LS_VOCAB_KEY:"activeVocabulary",LS_VOICE_KEY:"selectedVoiceURI"}),I=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`session-${Date.now()}-${Math.random().toString(36).slice(2)}`,A=(()=>{let e=!1;function d(){return e}function n(){const t=document.getElementById("app"),c=document.getElementById("partner-mode-toggle");e?(t.classList.add("partner-mode"),c.textContent="ðŸ”“",c.setAttribute("aria-pressed","true"),c.title="Partner Mode ON â€” tap to disable"):(t.classList.remove("partner-mode"),c.textContent="ðŸ”’",c.setAttribute("aria-pressed","false"),c.title="Enable Partner Mode")}function u(){e=!e,n(),w.log("partner_mode_changed",{active:e})}function o(){document.getElementById("partner-mode-toggle").addEventListener("click",u),n()}return{isActive:d,init:o}})(),w=(()=>{let e=null;function d(){return new Promise((o,t)=>{const c=indexedDB.open(f.DB_NAME,f.DB_VERSION);c.onupgradeneeded=g=>{const a=g.target.result;if(!a.objectStoreNames.contains(f.STORE_EVENTS)){const r=a.createObjectStore(f.STORE_EVENTS,{keyPath:"id",autoIncrement:!0});r.createIndex("timestamp","timestamp",{unique:!1}),r.createIndex("sessionId","sessionId",{unique:!1}),r.createIndex("type","type",{unique:!1})}},c.onsuccess=g=>{e=g.target.result,o(e)},c.onerror=g=>{t(g.target.error)}})}function n(o,t){const c={timestamp:new Date().toISOString(),sessionId:I,type:o,data:t,user:A.isActive()?"partner":"student"};if(!e){E.append({...c,id:"pending"});return}const r=e.transaction(f.STORE_EVENTS,"readwrite").objectStore(f.STORE_EVENTS).add(c);r.onsuccess=s=>{c.id=s.target.result,E.append(c)},r.onerror=()=>{}}function u(){return new Promise((o,t)=>{if(!e)return t(new Error("DB not ready"));const g=e.transaction(f.STORE_EVENTS,"readonly").objectStore(f.STORE_EVENTS).getAll();g.onsuccess=()=>o(g.result),g.onerror=()=>t(g.error)})}return{open:d,log:n,getAll:u}})(),b=(()=>{let e=!1;function d(){if(e||!window.speechSynthesis)return;e=!0;const o=new SpeechSynthesisUtterance("");o.volume=0,window.speechSynthesis.speak(o)}function n(o){if(!window.speechSynthesis)return;window.speechSynthesis.cancel();const t=new SpeechSynthesisUtterance(o);t.rate=.9,t.pitch=1,t.volume=1;try{const c=localStorage.getItem(f.LS_VOICE_KEY);if(c){const g=window.speechSynthesis.getVoices().find(a=>a.voiceURI===c);g&&(t.voice=g)}}catch{}window.speechSynthesis.speak(t)}function u(){window.addEventListener("load",()=>{var o;return(o=window.speechSynthesis)==null?void 0:o.getVoices()}),document.addEventListener("pointerdown",d,{once:!0,capture:!0})}return{speak:n,init:u}})(),L=(()=>{function e(t,c){const g=c.charAt(0).toUpperCase(),r=`<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100'><rect width='100' height='100' rx='18' fill='${`hsl(${c.charCodeAt(0)*37%360}, 70%, 60%)`}'/><text x='50' y='62' text-anchor='middle' font-size='56' fill='#fff' font-family='Arial' dy='.3em'>${g}</text></svg>`;t.src="data:image/svg+xml;utf8,"+encodeURIComponent(r),t.alt=c}const d=window.location.pathname.includes("TapTalk-App")?"/TapTalk-App/aac-images/":"/aac-images/";function n(t){return`${d}${t.toLowerCase()}.png`}function u(t,c){t.src=n(c),t.onerror=()=>{t.onerror=null,e(t,c)}}function o(t){return n(t)}return{load:u,getCachedUrl:o}})(),E=(()=>{const e=()=>document.getElementById("dev-preview-entries"),d=()=>document.getElementById("dev-preview-count");let n=0;function u(){var s;document.getElementById("dev-status-session").textContent=I.slice(0,13)+"â€¦",document.getElementById("dev-status-version").textContent=((s=window.TapTalk)==null?void 0:s.version)??"1.0.0",document.getElementById("dev-preview-clear").addEventListener("click",()=>{e().innerHTML="",n=0,o()}),document.getElementById("dev-preview-refresh").addEventListener("click",g),document.getElementById("dev-preview-export").addEventListener("click",async()=>{var i;try{const m=await((i=window.exportTapTalkData)==null?void 0:i.call(window));if(!m)return;const l=new Blob([m],{type:"application/json"}),p=URL.createObjectURL(l),h=document.createElement("a");h.href=p,h.download=`taptalk-export-${Date.now()}.json`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(p)}catch{}})}function o(){d().textContent=`${n} event${n!==1?"s":""} logged`}function t(s){const i=document.createElement("div");i.className="dev-log-entry";const m=new Date(s.timestamp).toLocaleTimeString(),l=s.id!=null?`[${s.id}] `:"";return i.innerHTML=`<span class="log-time">${m}</span><span class="log-type">${l}${s.type}</span>${JSON.stringify(s.data)}`,i}function c(s){n++,o(),e().prepend(t(s))}async function g(){try{const s=await w.getAll();e().innerHTML="",n=s.length,o(),[...s].reverse().forEach(i=>e().appendChild(t(i)))}catch{}}function a(s){const i=document.getElementById("dev-status-db");i.textContent=s?"open âœ“":"error âœ—",i.className="dev-status-value "+(s?"dev-status-ok":"dev-status-err")}function r(s,i){const m=document.getElementById("dev-status-sw");m.textContent=s,m.className="dev-status-value "+(i?"dev-status-ok":"dev-status-err")}return{init:u,append:c,setDbStatus:a,setSwStatus:r}})(),$=(()=>{function e(n){document.querySelectorAll(".view").forEach(u=>u.classList.remove("active")),document.querySelectorAll(".nav-btn").forEach(u=>u.classList.remove("active")),document.getElementById(`view-${n}`).classList.add("active"),document.querySelector(`.nav-btn[data-view="${n}"]`).classList.add("active"),w.log("view_changed",{view:n})}function d(){document.querySelectorAll(".nav-btn").forEach(n=>{n.addEventListener("click",()=>e(n.dataset.view))})}return{init:d,switchTo:e}})(),R=(()=>{function e(){["yes","no"].forEach(n=>{const u=document.getElementById(`btn-${n}`),o=document.getElementById(`img-${n}`);L.load(o,n),u.addEventListener("click",()=>{var t;b.speak(n),w.log("vocabulary_use",{word:n,category:"core_vocab"}),(t=window.CommDB)==null||t.logEvent("single_word",{words:[n],view:"core-vocab"})})})}return{init:e}})(),D=(()=>{const e=[null,null];function d(a,r){const s=document.getElementById(`slot-${a+1}`);s.classList.remove("empty"),s.innerHTML="";const i=document.createElement("img");i.alt=r,s.appendChild(i),L.load(i,r);const m=document.createElement("span");m.className="slot-label",m.textContent=r,s.appendChild(m)}function n(a){const r=document.getElementById(`slot-${a+1}`);r.classList.add("empty"),r.innerHTML='<span class="slot-placeholder">?</span>'}function u(a){var r,s;if(e[0]===null)e[0]=a,d(0,a),w.log("choice_slot_filled",{slot:1,word:a});else if(e[1]===null){e[1]=a,d(1,a);const i=`${e[0]} or ${e[1]}`;b.speak(i),w.log("choice_made",{choice1:e[0],choice2:e[1],phrase:i}),(r=window.CommDB)==null||r.logEvent("sentence_formed",{words:[e[0],e[1]],view:"choice-board"})}else b.speak(`${e[0]} or ${e[1]}`),(s=window.CommDB)==null||s.logEvent("sentence_formed",{words:[e[0],e[1]],view:"choice-board"})}function o(){var a;e[0]=null,e[1]=null,n(0),n(1),w.log("choice_cleared",{}),(a=window.CommDB)==null||a.logEvent("clear_board",{words:[],view:"choice-board"})}function t(a){const r=document.getElementById("choice-bank");r.innerHTML="",a.forEach(s=>{const i=document.createElement("div");i.className="bank-item",i.setAttribute("role","button"),i.setAttribute("aria-label",s),i.dataset.word=s;const m=document.createElement("img");m.alt=s;const l=document.createElement("span");l.className="item-label",l.textContent=s,i.appendChild(m),i.appendChild(l),r.appendChild(i),L.load(m,s),i.addEventListener("click",()=>u(s))})}function c(){let a;try{const r=localStorage.getItem(f.LS_VOCAB_KEY);a=r?JSON.parse(r):f.BANK_ITEMS.map(s=>s.toLowerCase())}catch{a=f.BANK_ITEMS.map(s=>s.toLowerCase())}t(a),document.getElementById("slot-1").addEventListener("click",()=>{var r;e[0]&&(b.speak(e[0]),(r=window.CommDB)==null||r.logEvent("single_word",{words:[e[0]],view:"choice-board"}))}),document.getElementById("slot-2").addEventListener("click",()=>{var r;e[1]&&(b.speak(e[1]),(r=window.CommDB)==null||r.logEvent("single_word",{words:[e[1]],view:"choice-board"}))}),document.getElementById("btn-clear").addEventListener("click",o)}function g(a){[0,1].forEach(r=>{e[r]=null,n(r)}),t(a)}return{init:c,rebuild:g}})(),j=(()=>{function e(){f.TURN_VOCAB.forEach(d=>{const n=d.replace("-"," "),u=document.getElementById(`btn-${d}`),o=document.getElementById(`img-${d}`);L.load(o,d),u.addEventListener("click",()=>{var t;b.speak(n),w.log("vocabulary_use",{word:n,category:"turn_taking"}),(t=window.CommDB)==null||t.logEvent("single_word",{words:[n],view:"turn-taking"})})})}return{init:e}})(),M=(()=>{function e(){const n=document.getElementById("orientation-warning");window.innerWidth<window.innerHeight?n.classList.add("visible"):n.classList.remove("visible")}function d(){e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",e)}return{init:d}})(),x=(()=>{async function e(){const o=document.getElementById("aos-db-summary");if(o)try{const t=await CommDB.getAll();if(t.length===0){o.textContent="No interactions stored yet.";return}const c=t.reduce((a,r)=>r.timestamp<a?r.timestamp:a,t[0].timestamp),g=new Date(c).toLocaleDateString();o.textContent=`Currently storing ${t.length} interaction${t.length!==1?"s":""} since ${g}.`}catch{o.textContent="Unable to read database."}}async function d(){try{const o=await generateOSPayload(),t=JSON.stringify(o,null,2),c=new Blob([t],{type:"application/json"}),g=`taptalk-export-${Date.now()}.json`;if(navigator.canShare)try{const s=new File([c],g,{type:"application/json"});if(navigator.canShare({files:[s]})){await navigator.share({files:[s],title:"TapTalk Export"}),w.log("data_exported",{method:"share",records:o.metrics.totalEvents});return}}catch(s){if(s.name==="AbortError")return}const a=URL.createObjectURL(c),r=document.createElement("a");r.href=a,r.download=g,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a),w.log("data_exported",{method:"download",records:o.metrics.totalEvents})}catch{}}async function n(){if(window.prompt(`This will permanently delete all stored interactions.

Type DELETE to confirm:`)==="DELETE")try{await CommDB.clearAll(),w.log("database_cleared",{}),await e()}catch{}}function u(){document.getElementById("aos-export-btn").addEventListener("click",d),document.getElementById("aos-clear-btn").addEventListener("click",n)}return{init:u,refresh:e}})(),P=(()=>{const e=["i","you","he","she","it","we","they","me","my","your","that","go","stop","want","help","play","eat","drink","see","come","like","need","get","make","do","have","look","feel","put","sit","stand","open","close","give","take","push","pull","throw","jump","walk","read","in","on","up","down","out","off","here","there","with","away","good","bad","big","little","hot","cold","fast","slow","dirty","clean","loud","quiet","different","same","favorite","broken","more","done","finished","again","mine","what","where","when","why","who","how","bathroom","water","food","home","school","car","bed","book","ball","music","outside","inside","chair","table","yes","no","please","wait","sorry","no-thank-you","all-done","i-dont-know","good-job","red","blue","green","yellow","orange","purple","pink","happy","sad","mad","tired","hungry","thirsty","sick","hurt","my-turn","your-turn","rocks","coloring","math","writing"];let d=[],n=null;const u=3e3;function o(){try{const l=localStorage.getItem(f.LS_VOCAB_KEY);if(l)return JSON.parse(l)}catch{}return f.BANK_ITEMS.map(l=>l.toLowerCase())}async function t(){try{const l=await fetch("./aac-images/vocabulary.json");if(l.ok){const p=await l.json();if(Array.isArray(p)&&p.length>0)return p}}catch{}return e}function c(){t().then(l=>{d=l,a(),document.getElementById("settings-search").value="",r(l,""),x.refresh(),document.getElementById("settings-modal").classList.add("open")})}function g(){document.getElementById("settings-modal").classList.remove("open")}function a(){var C;const l=document.getElementById("voice-select"),p=((C=window.speechSynthesis)==null?void 0:C.getVoices())??[],h=localStorage.getItem(f.LS_VOICE_KEY)||"";l.innerHTML="";const y=document.createElement("option");y.value="",y.textContent="Default voice",l.appendChild(y),p.forEach(v=>{const S=document.createElement("option");S.value=v.voiceURI,S.textContent=`${v.name} (${v.lang})`,v.voiceURI===h&&(S.selected=!0),l.appendChild(S)})}function r(l,p){const h=document.getElementById("settings-word-grid"),y=new Set(o());h.innerHTML="",(p?l.filter(v=>v.includes(p.toLowerCase())):l).forEach(v=>{const S=y.has(v),B=document.createElement("label");B.className="settings-word-item"+(S?" active":"");const _=document.createElement("input");_.type="checkbox",_.className="settings-word-check",_.dataset.word=v,_.checked=S,_.addEventListener("change",()=>B.classList.toggle("active",_.checked));const k=document.createElement("img");k.className="settings-word-img",k.alt=v,L.load(k,v);const T=document.createElement("span");T.className="settings-word-label",T.textContent=v,B.append(_,k,T),h.appendChild(B)})}function s(){const l=Array.from(document.querySelectorAll(".settings-word-check:checked"),p=>p.dataset.word);try{localStorage.setItem(f.LS_VOCAB_KEY,JSON.stringify(l))}catch{}D.rebuild(l),w.log("settings_saved",{activeVocabulary:l}),g()}function i(){const l=document.getElementById("settings-btn");function p(){n=setTimeout(()=>{n=null,c()},u)}function h(){n&&(clearTimeout(n),n=null)}l.addEventListener("pointerdown",p),l.addEventListener("pointerup",h),l.addEventListener("pointerleave",h),l.addEventListener("pointercancel",h),l.addEventListener("contextmenu",y=>y.preventDefault())}function m(){var l;i(),document.getElementById("settings-modal-close").addEventListener("click",g),document.getElementById("settings-save").addEventListener("click",s),document.getElementById("settings-search").addEventListener("input",p=>r(d,p.target.value.trim())),document.getElementById("voice-select").addEventListener("change",p=>{try{localStorage.setItem(f.LS_VOICE_KEY,p.target.value)}catch{}}),(l=window.speechSynthesis)==null||l.addEventListener("voiceschanged",()=>{document.getElementById("settings-modal").classList.contains("open")&&a()})}return{init:m,getActiveVocab:o}})();function U(){"serviceWorker"in navigator?navigator.serviceWorker.register("./sw.js").then(e=>{E.setSwStatus("active âœ“",!0)}).catch(e=>{E.setSwStatus("failed âœ—",!1)}):E.setSwStatus("unsupported",!1)}async function q(){U();try{await w.open(),E.setDbStatus(!0)}catch{E.setDbStatus(!1)}$.init(),A.init(),b.init(),R.init(),D.init(),j.init(),E.init(),M.init(),P.init(),x.init(),w.log("session_start",{sessionId:I,appVersion:"1.0.0",userAgent:navigator.userAgent})}window.TapTalk={version:"1.0.0",getSessionId:()=>I,exportData:()=>w.getAll()};window.PartnerMode=A;document.addEventListener("DOMContentLoaded",q);
