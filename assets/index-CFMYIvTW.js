(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function n(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(t){if(t.ep)return;t.ep=!0;const o=n(t);fetch(t.href,o)}})();const R="TapTalkDB",v="comm_events";let C=null;async function D(){return C||new Promise((e,s)=>{const n=indexedDB.open(R,1);n.onupgradeneeded=c=>{const t=c.target.result;t.objectStoreNames.contains(v)||t.createObjectStore(v,{keyPath:"id",autoIncrement:!0})},n.onsuccess=c=>{C=c.target.result,e(C)},n.onerror=c=>{console.warn("[TapTalkDB] Open error â€” logging disabled, app continues normally:",c.target.error),s(c.target.error)}})}const x={async logEvent(e,s){var c;const n={timestamp:new Date().toISOString(),eventType:e,words:Array.isArray(s.words)?s.words:[],view:s.view||"",user:(c=window.PartnerMode)!=null&&c.isActive()?"partner":"student"};try{(await D()).transaction(v,"readwrite").objectStore(v).add(n)}catch(t){console.warn("[TapTalkDB] logEvent failed â€” app continues normally:",t)}},async getAll(){const e=await D();return new Promise((s,n)=>{const t=e.transaction(v,"readonly").objectStore(v).getAll();t.onsuccess=()=>s(t.result),t.onerror=()=>n(t.error)})},async clearAll(){const e=await D();return new Promise((s,n)=>{const t=e.transaction(v,"readwrite").objectStore(v).clear();t.onsuccess=()=>s(),t.onerror=()=>n(t.error)})}};window.CommDB=x;window.exportTapTalkData=async function(){const e=await x.getAll(),s=JSON.stringify(e,null,2);return console.log("[TapTalkDB] exportTapTalkData ("+e.length+` records):
`,s),s};async function j(){const e=await CommDB.getAll(),s=e.filter(c=>c.user==="student").length,n=e.filter(c=>c.user==="partner").length;return{source:"TapTalk_AAC",version:"1.0",exportDate:new Date().toISOString(),metrics:{totalEvents:e.length,studentEvents:s,partnerModeEvents:n},logs:e}}window.generateOSPayload=j;function M(){try{const e=localStorage.getItem(p.LS_VOCAB_KEY);if(e)return JSON.parse(e)}catch{}return[]}window.getVocab=M;const p=Object.freeze({DB_NAME:"taptalk-db",DB_VERSION:1,STORE_EVENTS:"events",BANK_ITEMS:["Rocks","Ball","Walk","Coloring","Book","Math","Writing"],CORE_VOCAB:["Yes","No"],TURN_VOCAB:["my-turn","your-turn"],LS_VOCAB_KEY:"activeVocabulary",LS_VOICE_KEY:"selectedVoiceURI"}),T=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`session-${Date.now()}-${Math.random().toString(36).slice(2)}`,N=(()=>{let e=!1;function s(){return e}function n(){const o=document.getElementById("app"),l=document.getElementById("partner-mode-toggle");e?(o.classList.add("partner-mode"),l.textContent="ðŸ”“",l.setAttribute("aria-pressed","true"),l.title="Partner Mode ON â€” tap to disable"):(o.classList.remove("partner-mode"),l.textContent="ðŸ”’",l.setAttribute("aria-pressed","false"),l.title="Enable Partner Mode")}function c(){e=!e,n(),h.log("partner_mode_changed",{active:e})}function t(){document.getElementById("partner-mode-toggle").addEventListener("click",c),n()}return{isActive:s,init:t}})(),h=(()=>{let e=null;function s(){return new Promise((t,o)=>{const l=indexedDB.open(p.DB_NAME,p.DB_VERSION);l.onupgradeneeded=m=>{const d=m.target.result;if(!d.objectStoreNames.contains(p.STORE_EVENTS)){const a=d.createObjectStore(p.STORE_EVENTS,{keyPath:"id",autoIncrement:!0});a.createIndex("timestamp","timestamp",{unique:!1}),a.createIndex("sessionId","sessionId",{unique:!1}),a.createIndex("type","type",{unique:!1})}},l.onsuccess=m=>{e=m.target.result,t(e)},l.onerror=m=>{o(m.target.error)}})}function n(t,o){const l={timestamp:new Date().toISOString(),sessionId:T,type:t,data:o,user:N.isActive()?"partner":"student"};if(!e){y.append({...l,id:"pending"});return}const a=e.transaction(p.STORE_EVENTS,"readwrite").objectStore(p.STORE_EVENTS).add(l);a.onsuccess=r=>{l.id=r.target.result,y.append(l)},a.onerror=()=>{}}function c(){return new Promise((t,o)=>{if(!e)return o(new Error("DB not ready"));const m=e.transaction(p.STORE_EVENTS,"readonly").objectStore(p.STORE_EVENTS).getAll();m.onsuccess=()=>t(m.result),m.onerror=()=>o(m.error)})}return{open:s,log:n,getAll:c}})(),L=(()=>{let e=!1;function s(){if(e||!window.speechSynthesis)return;e=!0;const t=new SpeechSynthesisUtterance("");t.volume=0,window.speechSynthesis.speak(t)}function n(t){if(!window.speechSynthesis)return;window.speechSynthesis.cancel();const o=new SpeechSynthesisUtterance(t);o.rate=.9,o.pitch=1,o.volume=1;try{const l=localStorage.getItem(p.LS_VOICE_KEY);if(l){const m=window.speechSynthesis.getVoices().find(d=>d.voiceURI===l);m&&(o.voice=m)}}catch{}window.speechSynthesis.speak(o)}function c(){window.addEventListener("load",()=>{var t;return(t=window.speechSynthesis)==null?void 0:t.getVoices()}),document.addEventListener("pointerdown",s,{once:!0,capture:!0})}return{speak:n,init:c}})(),B=(()=>{const s=window.location.hostname.includes("github.io")?"TapTalk-App/":"";function n(o){return`${s}aac-images/${o.toLowerCase()}`}function c(o,l){o.src=n(l),o.alt=l,o.onerror=null}function t(o){return n(o)}return{load:c,getCachedUrl:t}})(),y=(()=>{const e=()=>document.getElementById("dev-preview-entries"),s=()=>document.getElementById("dev-preview-count");let n=0;function c(){var r;document.getElementById("dev-status-session").textContent=T.slice(0,13)+"â€¦",document.getElementById("dev-status-version").textContent=((r=window.TapTalk)==null?void 0:r.version)??"1.0.0",document.getElementById("dev-preview-clear").addEventListener("click",()=>{e().innerHTML="",n=0,t()}),document.getElementById("dev-preview-refresh").addEventListener("click",m),document.getElementById("dev-preview-export").addEventListener("click",async()=>{var u;try{const f=await((u=window.exportTapTalkData)==null?void 0:u.call(window));if(!f)return;const i=new Blob([f],{type:"application/json"}),g=URL.createObjectURL(i),w=document.createElement("a");w.href=g,w.download=`taptalk-export-${Date.now()}.json`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(g)}catch{}})}function t(){s().textContent=`${n} event${n!==1?"s":""} logged`}function o(r){const u=document.createElement("div");u.className="dev-log-entry";const f=new Date(r.timestamp).toLocaleTimeString(),i=r.id!=null?`[${r.id}] `:"";return u.innerHTML=`<span class="log-time">${f}</span><span class="log-type">${i}${r.type}</span>${JSON.stringify(r.data)}`,u}function l(r){n++,t(),e().prepend(o(r))}async function m(){try{const r=await h.getAll();e().innerHTML="",n=r.length,t(),[...r].reverse().forEach(u=>e().appendChild(o(u)))}catch{}}function d(r){const u=document.getElementById("dev-status-db");u.textContent=r?"open âœ“":"error âœ—",u.className="dev-status-value "+(r?"dev-status-ok":"dev-status-err")}function a(r,u){const f=document.getElementById("dev-status-sw");f.textContent=r,f.className="dev-status-value "+(u?"dev-status-ok":"dev-status-err")}return{init:c,append:l,setDbStatus:d,setSwStatus:a}})(),P=(()=>{function e(n){document.querySelectorAll(".view").forEach(c=>c.classList.remove("active")),document.querySelectorAll(".nav-btn").forEach(c=>c.classList.remove("active")),document.getElementById(`view-${n}`).classList.add("active"),document.querySelector(`.nav-btn[data-view="${n}"]`).classList.add("active"),h.log("view_changed",{view:n})}function s(){document.querySelectorAll(".nav-btn").forEach(n=>{n.addEventListener("click",()=>e(n.dataset.view))})}return{init:s,switchTo:e}})(),U=(()=>{function e(){["yes","no"].forEach(n=>{const c=document.getElementById(`btn-${n}`),t=document.getElementById(`img-${n}`);B.load(t,n),c.addEventListener("click",()=>{var o;L.speak(n),h.log("vocabulary_use",{word:n,category:"core_vocab"}),(o=window.CommDB)==null||o.logEvent("single_word",{words:[n],view:"core-vocab"})})})}return{init:e}})(),V=(()=>{const e=[null,null];function s(d,a){const r=document.getElementById(`slot-${d+1}`);r.classList.remove("empty"),r.innerHTML="";const u=document.createElement("img");u.alt=a,r.appendChild(u),B.load(u,a);const f=document.createElement("span");f.className="slot-label",f.textContent=a,r.appendChild(f)}function n(d){const a=document.getElementById(`slot-${d+1}`);a.classList.add("empty"),a.innerHTML='<span class="slot-placeholder">?</span>'}function c(d){var a,r;if(e[0]===null)e[0]=d,s(0,d),h.log("choice_slot_filled",{slot:1,word:d});else if(e[1]===null){e[1]=d,s(1,d);const u=`${e[0]} or ${e[1]}`;L.speak(u),h.log("choice_made",{choice1:e[0],choice2:e[1],phrase:u}),(a=window.CommDB)==null||a.logEvent("sentence_formed",{words:[e[0],e[1]],view:"choice-board"})}else L.speak(`${e[0]} or ${e[1]}`),(r=window.CommDB)==null||r.logEvent("sentence_formed",{words:[e[0],e[1]],view:"choice-board"})}function t(){var d;e[0]=null,e[1]=null,n(0),n(1),h.log("choice_cleared",{}),(d=window.CommDB)==null||d.logEvent("clear_board",{words:[],view:"choice-board"})}function o(d){const a=document.getElementById("choice-bank");a.innerHTML="",d.forEach(r=>{const u=document.createElement("div");u.className="bank-item",u.setAttribute("role","button"),u.setAttribute("aria-label",r),u.dataset.word=r;const f=document.createElement("img");f.alt=r;const i=document.createElement("span");i.className="item-label",i.textContent=r,u.appendChild(f),u.appendChild(i),a.appendChild(u),B.load(f,r),u.addEventListener("click",()=>c(r))})}function l(){let d;try{const a=localStorage.getItem(p.LS_VOCAB_KEY);d=a?JSON.parse(a):p.BANK_ITEMS.map(r=>r.toLowerCase())}catch{d=p.BANK_ITEMS.map(r=>r.toLowerCase())}o(d),document.getElementById("slot-1").addEventListener("click",()=>{var a;e[0]&&(L.speak(e[0]),(a=window.CommDB)==null||a.logEvent("single_word",{words:[e[0]],view:"choice-board"}))}),document.getElementById("slot-2").addEventListener("click",()=>{var a;e[1]&&(L.speak(e[1]),(a=window.CommDB)==null||a.logEvent("single_word",{words:[e[1]],view:"choice-board"}))}),document.getElementById("btn-clear").addEventListener("click",t)}function m(d){[0,1].forEach(a=>{e[a]=null,n(a)}),o(d)}return{init:l,rebuild:m}})(),q=(()=>{function e(){p.TURN_VOCAB.forEach(s=>{const n=s.replace("-"," "),c=document.getElementById(`btn-${s}`),t=document.getElementById(`img-${s}`);B.load(t,s),c.addEventListener("click",()=>{var o;L.speak(n),h.log("vocabulary_use",{word:n,category:"turn_taking"}),(o=window.CommDB)==null||o.logEvent("single_word",{words:[n],view:"turn-taking"})})})}return{init:e}})(),K=(()=>{function e(){const n=document.getElementById("orientation-warning");window.innerWidth<window.innerHeight?n.classList.add("visible"):n.classList.remove("visible")}function s(){e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",e)}return{init:s}})(),$=(()=>{async function e(){const t=document.getElementById("aos-db-summary");if(t)try{const o=await CommDB.getAll();if(o.length===0){t.textContent="No interactions stored yet.";return}const l=o.reduce((d,a)=>a.timestamp<d?a.timestamp:d,o[0].timestamp),m=new Date(l).toLocaleDateString();t.textContent=`Currently storing ${o.length} interaction${o.length!==1?"s":""} since ${m}.`}catch{t.textContent="Unable to read database."}}async function s(){try{const t=await generateOSPayload(),o=JSON.stringify(t,null,2),l=new Blob([o],{type:"application/json"}),m=`taptalk-export-${Date.now()}.json`;if(navigator.canShare)try{const r=new File([l],m,{type:"application/json"});if(navigator.canShare({files:[r]})){await navigator.share({files:[r],title:"TapTalk Export"}),h.log("data_exported",{method:"share",records:t.metrics.totalEvents});return}}catch(r){if(r.name==="AbortError")return}const d=URL.createObjectURL(l),a=document.createElement("a");a.href=d,a.download=m,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(d),h.log("data_exported",{method:"download",records:t.metrics.totalEvents})}catch{}}async function n(){if(window.prompt(`This will permanently delete all stored interactions.

Type DELETE to confirm:`)==="DELETE")try{await CommDB.clearAll(),h.log("database_cleared",{}),await e()}catch{}}function c(){document.getElementById("aos-export-btn").addEventListener("click",s),document.getElementById("aos-clear-btn").addEventListener("click",n)}return{init:c,refresh:e}})(),H=(()=>{const e=["i","you","he","she","it","we","they","me","my","your","that","go","stop","want","help","play","eat","drink","see","come","like","need","get","make","do","have","look","feel","put","sit","stand","open","close","give","take","push","pull","throw","jump","walk","read","in","on","up","down","out","off","here","there","with","away","good","bad","big","little","hot","cold","fast","slow","dirty","clean","loud","quiet","different","same","favorite","broken","more","done","finished","again","mine","what","where","when","why","who","how","bathroom","water","food","home","school","car","bed","book","ball","music","outside","inside","chair","table","yes","no","please","wait","sorry","no-thank-you","all-done","i-dont-know","good-job","red","blue","green","yellow","orange","purple","pink","happy","sad","mad","tired","hungry","thirsty","sick","hurt","my-turn","your-turn","rocks","coloring","math","writing"];let s=[],n=null;const c=3e3;function t(){try{const i=localStorage.getItem(p.LS_VOCAB_KEY);if(i)return JSON.parse(i)}catch{}return p.BANK_ITEMS.map(i=>i.toLowerCase())}async function o(){try{const i=await fetch("./aac-images/vocabulary.json");if(i.ok){const g=await i.json();if(Array.isArray(g)&&g.length>0)return g}}catch{}return e}function l(){o().then(i=>{s=i,d(),document.getElementById("settings-search").value="",a(i,""),$.refresh(),document.getElementById("settings-modal").classList.add("open")})}function m(){document.getElementById("settings-modal").classList.remove("open")}function d(){var O;const i=document.getElementById("voice-select"),g=((O=window.speechSynthesis)==null?void 0:O.getVoices())??[],w=localStorage.getItem(p.LS_VOICE_KEY)||"";i.innerHTML="";const b=document.createElement("option");b.value="",b.textContent="Default voice",i.appendChild(b),g.forEach(E=>{const S=document.createElement("option");S.value=E.voiceURI,S.textContent=`${E.name} (${E.lang})`,E.voiceURI===w&&(S.selected=!0),i.appendChild(S)})}function a(i,g){const w=document.getElementById("settings-word-grid"),b=new Set(t());w.innerHTML="",(g?i.filter(E=>E.includes(g.toLowerCase())):i).forEach(E=>{const S=b.has(E),k=document.createElement("label");k.className="settings-word-item"+(S?" active":"");const _=document.createElement("input");_.type="checkbox",_.className="settings-word-check",_.dataset.word=E,_.checked=S,_.addEventListener("change",()=>k.classList.toggle("active",_.checked));const I=document.createElement("img");I.className="settings-word-img",I.alt=E,B.load(I,E);const A=document.createElement("span");A.className="settings-word-label",A.textContent=E,k.append(_,I,A),w.appendChild(k)})}function r(){const i=Array.from(document.querySelectorAll(".settings-word-check:checked"),g=>g.dataset.word);try{localStorage.setItem(p.LS_VOCAB_KEY,JSON.stringify(i))}catch{}V.rebuild(i),h.log("settings_saved",{activeVocabulary:i}),m()}function u(){const i=document.getElementById("settings-btn");function g(){n=setTimeout(()=>{n=null,l()},c)}function w(){n&&(clearTimeout(n),n=null)}i.addEventListener("pointerdown",g),i.addEventListener("pointerup",w),i.addEventListener("pointerleave",w),i.addEventListener("pointercancel",w),i.addEventListener("contextmenu",b=>b.preventDefault())}function f(){var i;u(),document.getElementById("settings-modal-close").addEventListener("click",m),document.getElementById("settings-save").addEventListener("click",r),document.getElementById("settings-search").addEventListener("input",g=>a(s,g.target.value.trim())),document.getElementById("voice-select").addEventListener("change",g=>{try{localStorage.setItem(p.LS_VOICE_KEY,g.target.value)}catch{}}),(i=window.speechSynthesis)==null||i.addEventListener("voiceschanged",()=>{document.getElementById("settings-modal").classList.contains("open")&&d()})}return{init:f,getActiveVocab:t}})();function Y(){"serviceWorker"in navigator?navigator.serviceWorker.register("./sw.js").then(e=>{y.setSwStatus("active âœ“",!0)}).catch(e=>{y.setSwStatus("failed âœ—",!1)}):y.setSwStatus("unsupported",!1)}async function W(){Y();try{await h.open(),y.setDbStatus(!0)}catch{y.setDbStatus(!1)}P.init(),N.init(),L.init(),U.init(),V.init(),q.init(),y.init(),K.init(),H.init(),$.init(),h.log("session_start",{sessionId:T,appVersion:"1.0.0",userAgent:navigator.userAgent})}window.TapTalk={version:"1.0.0",getSessionId:()=>T,exportData:()=>h.getAll()};window.PartnerMode=N;document.addEventListener("DOMContentLoaded",W);
